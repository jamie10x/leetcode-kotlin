name: üîî Daily LeetCode Reminder

on:
  schedule:
    - cron: "30 23 * * *"  # ‚è∞ 8:30 AM KST daily
  workflow_dispatch:

jobs:
  create-daily-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch Random Problem & Create Issue
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          TODAY=$(date -u +"%Y-%m-%d")
          TITLE="üß† Daily LeetCode Challenge ‚Äì $TODAY"

          echo "Fetching LeetCode problem list..."
          curl -s https://leetcode.com/api/problems/all/ -o problems.json
          TOTAL=$(jq '.stat_status_pairs | length' problems.json)

          echo "Selecting a random non-premium problem..."
          while true; do
            RAND_INDEX=$(( RANDOM % TOTAL ))
            PAID=$(jq ".stat_status_pairs[$RAND_INDEX].paid_only" problems.json)
            if [ "$PAID" = "false" ]; then
              break
            fi
          done

          NAME=$(jq -r ".stat_status_pairs[$RAND_INDEX].stat.question__title" problems.json)
          SLUG=$(jq -r ".stat_status_pairs[$RAND_INDEX].stat.question__title_slug" problems.json)
          DIFFICULTY_LEVEL=$(jq ".stat_status_pairs[$RAND_INDEX].difficulty.level" problems.json)
          if [ "$DIFFICULTY_LEVEL" -eq 1 ]; then DIFFICULTY="Easy"; fi
          if [ "$DIFFICULTY_LEVEL" -eq 2 ]; then DIFFICULTY="Medium"; fi
          if [ "$DIFFICULTY_LEVEL" -eq 3 ]; then DIFFICULTY="Hard"; fi
          URL="https://leetcode.com/problems/$SLUG"

          echo "Generating issue body..."
          BODY=$(cat <<EOF
  Hi @jamie10x üëã
  Time to grind! Solve at least **1 LeetCode problem** today üöÄ

### üîÄ Suggested Problem of the Day:
  **[$NAME]($URL)** ‚Äî _${DIFFICULTY}_
  
  Leave a comment below with what you solved! üéØ
  EOF
  )

echo "Creating issue: $TITLE"
  gh issue create --title "$TITLE" --body "$BODY" --label "daily"
